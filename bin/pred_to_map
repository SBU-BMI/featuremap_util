#!/usr/bin/env bash

NORMAL="\\033[0;39m"
RED="\\033[1;31m"
# Check input
if [[ "$#" -eq  "0" ]]
  then
    echo "No arguments supplied"
    printf "    ${RED}wsi type? svs, tif, or scn?${NORMAL}\n"
    exit 1
fi
ext="$1"

# Prediction to PNG
/app/src/get_grayscale_heatmaps/get_grayscale_heatmap.sh $ext


# PNG to CSV
uuid=$(python -c 'import sys,uuid; sys.stdout.write(uuid.uuid4().hex)') || uuid=$(uuidgen)
mydir="/tmp/$uuid"
mkdir -p "$mydir"
input='/data/input'
output='/data/output'
slide='/data/wsi'

python /app/src/png_to_csv_map.py "$output" "$mydir" "$slide" "$ext"

# CSV to JSON
python /app/src/csv_to_json.py "$mydir" "$output"
